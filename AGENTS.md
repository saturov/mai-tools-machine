# AGENTS.md

## Purpose
Единая инструкция для агентов в корне `my-tools-sandbox`: быстрый и безопасный workflow для "вайбкодинга" без потери качества.

## Project Scope
- Репозиторий: песочница утилит, схем и шаблонов для агентных workflow.
- Основные директории:
  - `docs/` — архитектура и дизайн-заметки.
  - `schemas/` — JSON-схемы контрактов.
  - `templates/` — шаблоны/заготовки.
  - `tools/` — актуальные утилиты.
  - `scripts/` — скрипты сборки/резолва реестра (Ruby).
  - `state/` — кэш и артефакты состояния (например, `registry-cache.json`).
- Вложенные подпроекты могут иметь собственные `AGENTS.md` (например, `tg-scraper/`) — они приоритетнее в своей директории.

## Default Working Style
- Делай минимальные, точечные изменения под задачу.
- Сначала рабочий результат, затем аккуратный рефакторинг только если реально нужен.
- Не трогай не относящиеся к задаче файлы и поведение.
- При неясности предпочитай текущее поведение проекта, а не "идеальную" перестройку.

## Request Handling Policy
- Разрешено обрабатывать запросы напрямую (по коду/документации) без обязательного запуска `scripts/dispatch.rb`.
- `make dispatch` остается рекомендуемым инструментом для задач, которые естественно ложатся на capability/workflow-пайплайн.
- Для side-effect задач обязательно явно фиксировать, что именно будет выполнено, и запускать только релевантные шаги в рамках запроса.

## Canonical Commands
- Показать доступные цели: `make help`
- Проверить манифесты: `make validate-manifests`
- Собрать кэш реестра: `make registry`
- Разрешить capability: `make resolve CAP=domain.action`
- Запустить unit-тесты реестра: `make test-registry`

## Change Policy
- Для изменений в `tools/*/tool.yaml` обязательно прогонять:
  1. `make validate-manifests`
  2. `make registry`
  3. (по необходимости) `make resolve CAP=...`
- Для изменений в `scripts/tool_registry.rb` запускать `make test-registry`.
- Не менять формат `state/registry-cache.json` вручную, если это не отдельная явная задача.

## Code and Docs Conventions
- Следовать текущему стилю файлов; не вводить новые фреймворки/структуры без запроса.
- Не переименовывать публичные capability/action без причины и миграционного шага.
- Если меняется поведение реестра/роутинга, обновлять `docs/skills-ecosystem-architecture.md` в той же задаче.
- Примеры команд в документации должны быть исполнимыми и актуальными.

## Safety Rules
- Не выполнять деструктивные git-команды (`reset --hard`, принудительные checkout) без явного запроса.
- Не коммитить секреты, токены и локальные служебные артефакты.
- Учитывать, что рабочее дерево может быть "грязным": не откатывать чужие изменения.

## Agent Checklist Before Finalizing
1. Изменения решают именно поставленную задачу и не расширяют scope.
2. Нужные `make`-проверки выполнены и результат зафиксирован в отчёте.
3. Документация синхронизирована с кодом (если поведение менялось).
4. В финальном ответе кратко: что сделано, какие проверки запущены, что осталось на усмотрение пользователя.
